# 捕将/斩将

本系统以目前阶段来看，一般改版玩家很难驾驭 所以在这里详细说明原理
- 1.捕将系统由173先生的敵将ゲットだぜ！！！完全版+27移植而已，并且修改了部分代码用来适应中文版
- 2.斩将系统由issimo制作，完成度接近90%，可能会存在BUG
- 3.本系统的很多参数还是未设定状态
- 4.大量解雇会造成错误，请不要这么做


捕将程序启动在系统内置的刷写武将程序之后，属于额外程序。
剧情战斗后可以招收/战死程序是捕将程序的第二分支，属于额外程序。
斩将程序依附在捕将程序第一阶段，选择不抓获敌将，就进入斩将程序

(测试修正显示斩杀/捕将姓名 暂时稳定)
敵将ゲットだぜ！！！完全版+27移植过程中，发现了对话程序F0在中文ROM中不可用性


警告：本程序可能会存在以下的问题
- 1.由于没有去接管原来的的武将状态刷写程序，可能会导致原来的设定和本设定冲突（*这个问题将会在以后解决）
    - 并且由于系统顺序，本系统额外追加的招收/战死程序为最后，故可以弃置原来的部分程序（不是全部程序）
- 2.捕将后续问题：部分敌将没有行走图，可能在路上走得非常奇怪，这不属于目前程序问题，属于设定问题
    - 参看文末行走图设定方法
- 3.如果你设定可以捕获的将领不可捕获，那么原版的一部分程序已经改写了
    - 这时你若不能解决，请找会6502的人来帮助你调试，并且*修改原版程序或者修改部分设定*
- 4.为了使其他章节显示前面章节武将，武将章节设定通篇报销，必须全部重新设定（指野外战斗）
    - 这个设定并不影响经验·金的获得设定
- 5.编成所虽然已扩充，但是也可能会产生不可预料的BUG，请慎重使用
- 6.部分战斗某些武将不可设置捕获敌方大将，设置后可能会造成战斗不止的BUG
    - （龚都战不可设置捕获龚都）


参数解释
$6200-$62FF 属于武将状态的展示

|数值|数值解释|
|--|--|
|00|不会出现|
|01|判定检查（作用猜测为地图上将显示的人物？）|
|80|大地图上出现的人物可剧情战斗，野外不出现|
|90（地图上出不出现不明）|野外出现的可捕获/斩杀武将|
|98|地图上不出现，野外战斗出现不可捕获/斩杀武将|
|C0|队列里的7人|
|E0|存在于编成所|

捕将状态决定了是否可捕获，所以招收程序用于强制写内存为90 战死程序用于强制写内存为00
达到了程序所要求的参数

提供部分关于武将设定的参数
0x7B12A-0x7B229 0x64340-0x6443F
以上地址可能会载入内存$6200-$62ff来改写武将状态
不止以上两个参数 还可能会有其他的设定参数 用的少 不详细赘述

- 本程序还拓展了E0限制（就是E0以后武将不在野战出现破除）改为FA
    - （实际上还有很多E0限制未破除 需要调试破除）

招收/斩将程序设定：

新代码适用 原先设定方法废弃

- 两个参数 
    - 1.武将番号 
    - 2.释放或者斩杀的战斗番号

|设定|地址|数值|
|--|--|--|
|招收武将|f9610+武将番号|释放的战斗番号|
|斩将武将|f9710+武将番号|斩杀的战斗番号|

- 设定举例
    - 1.例如纪灵武将番号19 我想在战斗00之后让他可以被捕捉
    - 2.那我就在f9629这个地址填入00即可

### 关于武将章节设定

- 设定的数值是:出场章节数-1=设定值
    - (tip:要是作为居民出现 不是野战 出场章节一般是+8 模型也就设定成了民众)
- 16进制修改参考特技系统举例的人物参数 第一个字节的高四位是设定章节 填入即可
    - (tip:高四位的看法是把这个数转为二进制 然后有低四位 有高四位*不足四位前面添0 共同组成的一个数)
    - (tip:16进制下 一个字节是由两个0-F的字符表示的 第一个字符是高四位 第二个字符是第四位)
- 日文修改器:找到ランク(出现章节)项 填入即可 
- 吞食天地2ROM编辑器:敌方专用的栏目下的出现章节填入即可

### 后续:下野遗迹不可捕获武将不可离队设定

`填入武将代码即可`

|地址|设定值|
|--|--|
|f9a10-f9a8f|强制不可捕获武将|
|f9a90-fab0f|不可下野武将|
|f9a10-fab8f|不可离队武将|

- 庞统不可离队位置:79193

- 去除本系统的方法:覆盖一下数据即可 这也是程序接口
    - 05342B:D0
    - 07A28D:4C 8E A2
    - 07A29B:4C 8E A2

最后说一句，这个系统本着通用来做的，实际上经过三天思考，发现暂时不可能了
以后可能会做到吧。

行走图设定方法

行走图一共是9F=144个

67A10－67AA0　移動キャラのデータアドレスA（144Byte）
67AA0－67B30　移動キャラのデータアドレスB（144Byte）

67B30－67FF0　キャラグラチップの並びデータ（7Byteづつ）

首先要获取行走图的番号

67A10+番号=下位
67AA0+番号=上位
5c010+上位下位=设定地址

这个地址开始总共7个字节 都是一个人物的

1バイト目：グラフィックのパレットと動きのパターン
　パレットに+$10すると、動きのパターンが変わります。（反転表示）
　手に武器を持っているキャラは、移動グラフィックを正面・側面・背面で2つ持っています。
　何も持っていないキャラは容量節約の為、反転表示させることで歩いているように見せています。
　（武器を持ったキャラを反転表示させると、武器を持ち替えているように見えて不自然）

2バイト目～7バイト目：正面・側面・背面のグラフィック指定


　キャラグラ色パレット
0 ＝白・赤
5 ＝青・黄
A ＝茶・緑
F ＝黄・黒（戦闘で使用すると不具合が出るので、平常時のみ使用可）

上記以外の数値では上下で色が異なる

例；1 ＝　上 白・赤　下 青・黄
　　2 ＝　上 白・赤　下 茶・緑
　　3 ＝　上 白・赤　下 黒・黄
　　4 ＝　上 青・黄　下 白・赤


ちなみに、キャラグラ画像の 7F が間違ってます。
7Fは襄陽城のボサボサホウ統でした。

以上内容来自173网站